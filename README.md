# 线下抽背记录版微信小程序

这是一个用于记录线下抽背结果和积分结算的微信小程序，用户可以在小程序中记录每日学习打卡状态和抽背结果，并通过积分系统进行激励。

## 功能概述

### 1. 用户管理
- 微信授权登录（OpenID/UnionID绑定）
- 用户资料展示（头像、昵称、当前积分、学习天数）

### 2. 学习打卡
- 每日打卡功能，记录学习天数
- 连续学习天数统计
- 免打卡特权功能

### 3. 线下抽背记录
- 手动输入抽背结果（正确数/错误数）
- 角色切换（提问者/答题者）
- 免抽背特权功能

### 4. 积分系统
- 每日打卡+1分（最多7分/周）
- 抽背全对+2分，每错1个-1分
- 缺卡惩罚：未打卡-2分
- 每周日24:00自动结算积分

### 5. 数据统计
- 每周学习报告
- 学习统计和趋势展示

## 技术架构

### 前端
- 微信小程序原生开发
- 页面结构：首页、打卡页、抽背记录页、个人中心、统计页

### 后端
- 微信云开发
- 云数据库：存储用户信息、打卡记录、抽背结果
- 云函数：处理业务逻辑、定时任务

## 云数据库结构

### users 集合（用户信息）
```json
{
  "_id": "用户ID",
  "nickName": "用户昵称",
  "avatarUrl": "头像URL",
  "score": 积分,
  "progress": {
    "totalDays": 总学习天数,
    "consecutiveDays": 连续学习天数
  },
  "skipCardCount": 免打卡特权数量,
  "skipQuizCardCount": 免抽背特权数量,
  "createdAt": 创建时间,
  "updatedAt": 更新时间
}
```

### signins 集合（打卡记录）
```json
{
  "_id": "打卡ID",
  "userId": "用户ID",
  "date": 打卡日期,
  "isSkip": 是否使用免打卡特权,
  "createdAt": 创建时间
}
```

### quizzes 集合（抽背记录）
```json
{
  "_id": "抽背ID",
  "userId": "用户ID",
  "date": 抽背日期,
  "correctCount": 正确数量,
  "wrongCount": 错误数量,
  "role": "角色（提问者/答题者）",
  "isSkip": 是否使用免抽背特权,
  "createdAt": 创建时间
}
```

## 云函数说明

### 1. login
- 功能：用户登录，查询或创建用户信息
- 调用方式：小程序端调用

### 2. doSignin
- 功能：处理每日打卡操作
- 调用方式：小程序端调用

### 3. recordQuiz
- 功能：记录抽背结果
- 调用方式：小程序端调用

### 4. useSkipCard
- 功能：使用免打卡特权
- 调用方式：小程序端调用

### 5. useSkipQuiz
- 功能：使用免抽背特权
- 调用方式：小程序端调用

### 6. calculateScore
- 功能：每周积分结算（定时任务）
- 调用方式：云开发定时触发器

## 部署指南

### 1. 开通云开发
- 在微信公众平台开启云开发功能
- 创建云开发环境，获取环境ID

### 2. 配置项目
- 在app.js中配置云开发环境（已配置为动态环境wx.cloud.DYNAMIC_CURRENT_ENV）
- 在project.config.json中配置appid和云开发环境ID
  - 已配置为`"cloudEnvironment": "cloud1-2gflwjg9b0331b73"`
  - 注意：如果需要更改环境，请替换为您的实际云开发环境ID

### 3. 创建数据库集合
- users
- signins
- quizzes

### 4. 部署云函数
- 上传所有云函数到云开发环境
- 确保每个云函数的环境配置正确（已配置为cloud.DYNAMIC_CURRENT_ENV）
- 配置calculateScore的定时触发器（每周日24:00）

### 5. 发布小程序
- 通过微信开发者工具上传代码
- 提交审核并发布

## 使用说明

1. **登录小程序**：使用微信授权登录
2. **每日打卡**：进入打卡页面，点击打卡按钮完成每日学习记录
3. **记录抽背**：进入抽背记录页面，输入抽背结果并提交
4. **查看统计**：进入统计页面查看学习数据和趋势
5. **个人中心**：查看个人信息、积分和特权数量

## 注意事项

- 确保云函数正确配置和部署
- 注意云开发资源的使用限额
- 用户需在抽背完成后及时录入结果
- 提供输入验证，确保数据准确性